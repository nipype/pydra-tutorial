
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>7. Two-Level GLM (from Nilearn) &#8212; Tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/7_twolevel_glm_nilearn';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Team" href="../about/team.html" />
    <link rel="prev" title="6. First Level GLM (from Nilearn)" href="6_firstlevel_glm_nilearn.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../welcome.html">

  
  
  
  
  
  
  

  
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/logo.jpg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="1_intro_pydra.html">
                        Intro to Pydra
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="2_intro_functiontask.html">
                        FunctionTask
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="3_intro_functiontask_state.html">
                        Tasks with States
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="4_intro_workflow.html">
                        Workflow
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="5_intro_shelltask.html">
                        ShellCommandTask
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="6_firstlevel_glm_nilearn.html">
                        First Level GLM (from Nilearn)
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Two-Level GLM (from Nilearn)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../about/team.html">
                        Team
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../about/cite_pydra.html">
                        Cite Pydra
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="1_intro_pydra.html">
                        Intro to Pydra
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="2_intro_functiontask.html">
                        FunctionTask
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="3_intro_functiontask_state.html">
                        Tasks with States
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="4_intro_workflow.html">
                        Workflow
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="5_intro_shelltask.html">
                        ShellCommandTask
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="6_firstlevel_glm_nilearn.html">
                        First Level GLM (from Nilearn)
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Two-Level GLM (from Nilearn)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../about/team.html">
                        Team
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../about/cite_pydra.html">
                        Cite Pydra
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="../welcome.html">

  
  
  
  
  
  
  

  
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="Logo image">
    <img src="../_static/logo.jpg" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../welcome.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic Concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1_intro_pydra.html">1. Intro to Pydra</a></li>
<li class="toctree-l1"><a class="reference internal" href="2_intro_functiontask.html">2. FunctionTask</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_intro_functiontask_state.html">3. Tasks with States</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_intro_workflow.html">4. Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_intro_shelltask.html">5. ShellCommandTask</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">General Linear Model</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="6_firstlevel_glm_nilearn.html">6. First Level GLM (from Nilearn)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">7. Two-Level GLM (from Nilearn)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About Pydra</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about/team.html">Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/cite_pydra.html">Cite Pydra</a></li>
</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">


<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://mybinder.org/v2/gh/nipype/pydra-tutorial/master?urlpath=tree/jupyterbook/notebooks/7_twolevel_glm_nilearn.md" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</a>
      
  </ul>
</div>

<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<div class="dropdown dropdown-repository-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://github.com/nipype/pydra-tutorial" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">repository</span>
</a>
</a>
      
      <li><a href="https://github.com/nipype/pydra-tutorial/issues/new?title=Issue%20on%20page%20%2Fnotebooks/7_twolevel_glm_nilearn.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">open issue</span>
</a>
</a>
      
  </ul>
</div>



<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="../_sources/notebooks/7_twolevel_glm_nilearn.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</a>
      
      <li><a href="../_sources/notebooks/7_twolevel_glm_nilearn.md" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</a>
      
      <li>
<button onclick="printPdf(this)"
  class="btn btn-sm dropdown-item"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</a>
      
  </ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary" data-toggle="tooltip" data-placement="left" title="Toggle secondary sidebar">
            <span class="fa-solid fa-list"></span>
        </label>
    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Two-Level GLM (from Nilearn)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparation">
   7.1. Preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data">
     7.1.1. Download the data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-data-for-each-subject">
     7.1.2. Get data for each subject
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-level-glm">
   7.2. First-Level GLM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-first-level-design-matrix">
     7.2.1. Get the first-level design matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-the-first-level-contrasts">
     7.2.2. Set up the first level contrasts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-the-first-level-glm">
     7.2.3. Fit the first level GLM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-first-level-glm-workflow">
     7.2.4. Create the first level GLM workflow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-fixed-effects">
     7.2.5. Compute fixed effects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-fixed-effect-workflow">
     7.2.6. Create the fixed effect workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#second-level-glm">
   7.3. Second-Level GLM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-second-level-design-matrix">
     7.3.1. Get the second level design matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-the-second-level-glm">
     7.3.2. Fit the second level GLM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-second-level-glm-workflow">
     7.3.3. Create the second level GLM workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistical-testing">
   7.4. Statistical Testing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-thresholding-and-plot-without-multiple-comparison">
     7.4.1. Cluster-thresholding and Plot without multiple comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-comparison-and-plot">
     7.4.2. Multiple comparison and Plot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paramatric-test-plot">
     7.4.3. Paramatric test &amp; Plot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#non-paramatric-test-plot">
     7.4.4. Non-paramatric test &amp; Plot
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-ultimate-workflow">
   7.5. The Ultimate Workflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-workflow-run">
     7.5.1. Run Workflow Run
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-plot">
   7.6. Let’s Plot!
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unthresholded">
     7.6.1. Unthresholded
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-thresholding">
     7.6.2. Cluster Thresholding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-comparison">
     7.6.3. Multiple Comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paramatric-test">
     7.6.4. Paramatric Test
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nonparamatric-test">
     7.6.5. Nonparamatric Test
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-1">
   7.7. Exercise #1
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-2">
   7.8. Exercise #2
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <section class="tex2jax_ignore mathjax_ignore" id="two-level-glm-from-nilearn">
<h1><span class="section-number">7. </span>Two-Level GLM (from Nilearn)<a class="headerlink" href="#two-level-glm-from-nilearn" title="Permalink to this heading">#</a></h1>
<p>In this tutorial, we demonstrate how to write pydra tasks for the first level (subject-level) GLM and the second level (group-level) GLM in Nilearn. We use the data from <a class="reference external" href="https://openneuro.org/datasets/ds000001/versions/1.0.0">Balloon Analog Risk-taking Task</a>.
Basic information about this dataset:</p>
<ul class="simple">
<li><p>16 subjects</p></li>
<li><p>3 runs</p></li>
<li><p>functional scan TR: 2.3</p></li>
<li><p>num of functional scan: 300</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="preparation">
<h2><span class="section-number">7.1. </span>Preparation<a class="headerlink" href="#preparation" title="Permalink to this heading">#</a></h2>
<p>Import packages that will be used globally and set up output directory</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">sys</span> 
<span class="k">if</span> <span class="ow">not</span> <span class="n">sys</span><span class="o">.</span><span class="n">warnoptions</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pydra</span>
<span class="kn">from</span> <span class="nn">pydra</span> <span class="kn">import</span> <span class="n">Workflow</span>
<span class="kn">from</span> <span class="nn">pydra.engine.specs</span> <span class="kn">import</span> <span class="n">File</span><span class="p">,</span> <span class="n">MultiInputFile</span><span class="p">,</span> <span class="n">MultiOutputFile</span>
<span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="nn">ty</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">datalad.api</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">nilearn.interfaces.fmriprep</span> <span class="kn">import</span> <span class="n">load_confounds_strategy</span>
<span class="kn">from</span> <span class="nn">nilearn.image</span> <span class="kn">import</span> <span class="n">load_img</span><span class="p">,</span> <span class="n">get_data</span><span class="p">,</span> <span class="n">math_img</span><span class="p">,</span> <span class="n">threshold_img</span>
<span class="kn">from</span> <span class="nn">nilearn.glm.first_level</span> <span class="kn">import</span> <span class="n">make_first_level_design_matrix</span><span class="p">,</span> <span class="n">FirstLevelModel</span>
<span class="kn">from</span> <span class="nn">nilearn.glm.second_level</span> <span class="kn">import</span> <span class="n">SecondLevelModel</span><span class="p">,</span> <span class="n">non_parametric_inference</span>
<span class="kn">from</span> <span class="nn">nilearn.glm.contrasts</span> <span class="kn">import</span> <span class="n">compute_fixed_effects</span>
<span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_stat_map</span><span class="p">,</span> <span class="n">plot_glass_brain</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get current directory</span>
<span class="n">pydra_tutorial_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="c1"># set up output directory</span>
<span class="n">workflow_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">pydra_tutorial_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;outputs&#39;</span>
<span class="n">workflow_out_dir</span> <span class="o">=</span> <span class="n">workflow_dir</span> <span class="o">/</span> <span class="s1">&#39;7_glm&#39;</span> <span class="o">/</span><span class="s1">&#39;results&#39;</span>

<span class="c1"># create folders if not exit</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="download-the-data">
<h3><span class="section-number">7.1.1. </span>Download the data<a class="headerlink" href="#download-the-data" title="Permalink to this heading">#</a></h3>
<p><a class="reference external" href="http://handbook.datalad.org/en/latest/index.htmlhttp://handbook.datalad.org/en/latest/index.html">DataLad</a> is often used in those cases to download data. Here we use its <a class="reference external" href="http://docs.datalad.org/en/latest/modref.htmlhttp://docs.datalad.org/en/latest/modref.html">Python API</a>.</p>
<p>We need the following data:</p>
<ol class="arabic simple">
<li><p>event information (raw data)</p></li>
<li><p>preprocessed image data (fmriprep)</p></li>
<li><p>masks (fmriprep)</p></li>
<li><p>confounds (fmriprep)</p></li>
</ol>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fmriprep_path</span> <span class="o">=</span> <span class="n">workflow_dir</span> <span class="o">/</span> <span class="s1">&#39;7_glm&#39;</span><span class="o">/</span> <span class="s1">&#39;data&#39;</span>
<span class="n">rawdata_path</span> <span class="o">=</span> <span class="n">workflow_dir</span> <span class="o">/</span> <span class="s1">&#39;7_glm&#39;</span> <span class="o">/</span> <span class="s1">&#39;raw_data&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fmriprep_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">rawdata_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Install datasets to specific datapaths</span>
<span class="n">fmriprep_url</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/OpenNeuroDerivatives/ds000001-fmriprep.git&#39;</span>
<span class="n">rawdata_url</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/OpenNeuroDatasets/ds000001.git&#39;</span>
<span class="n">dl</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">rawdata_url</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">rawdata_path</span><span class="p">)</span>
<span class="n">dl</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">fmriprep_url</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">fmriprep_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-data-for-each-subject">
<h3><span class="section-number">7.1.2. </span>Get data for each subject<a class="headerlink" href="#get-data-for-each-subject" title="Permalink to this heading">#</a></h3>
<p>By <code class="docutils literal notranslate"><span class="pre">datalad.api.install</span></code>, datalad downloads all symlinks without storing the actual data locally. We can then use <code class="docutils literal notranslate"><span class="pre">datalad.api.get</span></code> to get the data we need for our analysis.
We need to get four types of data from two folders:</p>
<ol class="arabic simple">
<li><p>event_info: <code class="docutils literal notranslate"><span class="pre">*events.tsv</span></code> from <code class="docutils literal notranslate"><span class="pre">rawdata_path</span></code></p></li>
<li><p>bold: <code class="docutils literal notranslate"><span class="pre">*space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz</span></code> from <code class="docutils literal notranslate"><span class="pre">fmriprep_path</span></code></p></li>
<li><p>mask: <code class="docutils literal notranslate"><span class="pre">*space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz</span></code> from <code class="docutils literal notranslate"><span class="pre">fmriprep_path</span></code></p></li>
<li><p>confounds: <code class="docutils literal notranslate"><span class="pre">*desc-confounds_timeseries.tsv</span></code> from <code class="docutils literal notranslate"><span class="pre">fmriprep_path</span></code> (this is implicitly needed by <code class="docutils literal notranslate"><span class="pre">load_confounds_strategy</span></code>)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;subj_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;subj_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;subj_events&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;subj_imgs&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;subj_masks&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">get_subjdata</span><span class="p">(</span><span class="n">subj_id</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Download data for subject-</span><span class="si">{</span><span class="n">subj_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># get events.tsv </span>
    <span class="n">subj_events</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rawdata_path</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subj_id</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;*events.tsv&#39;</span><span class="p">))</span>
    <span class="n">subj_events</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subj_events</span><span class="p">:</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">rawdata_path</span><span class="p">)</span>
    <span class="c1"># get bold</span>
    <span class="n">subj_imgs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmriprep_path</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subj_id</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;*space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz&#39;</span><span class="p">))</span>
    <span class="n">subj_imgs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subj_imgs</span><span class="p">:</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">fmriprep_path</span><span class="p">)</span>
    <span class="c1"># get mask</span>
    <span class="n">subj_masks</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmriprep_path</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subj_id</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;*space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz&#39;</span><span class="p">))</span>
    <span class="n">subj_masks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subj_masks</span><span class="p">:</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">fmriprep_path</span><span class="p">)</span>
    <span class="c1"># get confounds list</span>
    <span class="n">subj_confounds</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmriprep_path</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%02d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subj_id</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;*desc-confounds_timeseries.tsv&#39;</span><span class="p">))</span>
    <span class="n">subj_confounds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subj_confounds</span><span class="p">:</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">fmriprep_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subj_id</span><span class="p">,</span> <span class="n">subj_events</span><span class="p">,</span> <span class="n">subj_imgs</span><span class="p">,</span> <span class="n">subj_masks</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="first-level-glm">
<h2><span class="section-number">7.2. </span>First-Level GLM<a class="headerlink" href="#first-level-glm" title="Permalink to this heading">#</a></h2>
<p>The first level GLM has two parts:</p>
<ul class="simple">
<li><p>conduct GLM for each run on every subject</p></li>
<li><p>average across runs for each subject with a fixed-effect model</p></li>
</ul>
<section id="get-the-first-level-design-matrix">
<h3><span class="section-number">7.2.1. </span>Get the first-level design matrix<a class="headerlink" href="#get-the-first-level-design-matrix" title="Permalink to this heading">#</a></h3>
<p>The design matrix is a <em>M(row)</em> x <em>N(columns)</em> matrix. <em>M</em> corresponds to the number of <em>tr</em>, while <em>N</em> corresponds to event conditions + confounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;tr&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;n_scans&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;hrf_model&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;subj_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;subj_imgs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;subj_events&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dm_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">get_firstlevel_dm</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">n_scans</span><span class="p">,</span> <span class="n">hrf_model</span><span class="p">,</span> <span class="n">subj_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">subj_imgs</span><span class="p">,</span> <span class="n">subj_events</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Get subject-</span><span class="si">{</span><span class="n">subj_id</span><span class="si">}</span><span class="s2">, run-</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2"> firstlevel GLM design matrix...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># read event file</span>
    <span class="n">run_img</span> <span class="o">=</span> <span class="n">subj_imgs</span><span class="p">[</span><span class="n">run_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">run_event</span> <span class="o">=</span> <span class="n">subj_events</span><span class="p">[</span><span class="n">run_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">run_event</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">event</span><span class="p">[[</span><span class="s1">&#39;onset&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="s1">&#39;trial_type&#39;</span><span class="p">]]</span>
    <span class="c1"># get list of confounds directly from fmriprepped bold</span>
    <span class="n">confounds</span> <span class="o">=</span> <span class="n">load_confounds_strategy</span><span class="p">(</span><span class="n">run_img</span><span class="p">,</span> <span class="n">denoise_strategy</span><span class="o">=</span><span class="s1">&#39;simple&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">frame_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_scans</span><span class="p">)</span> <span class="o">*</span> <span class="n">tr</span>
    <span class="n">design_matrix</span> <span class="o">=</span> <span class="n">make_first_level_design_matrix</span><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> 
                                                   <span class="n">hrf_model</span><span class="o">=</span><span class="n">hrf_model</span><span class="p">,</span>
                                                   <span class="n">add_regs</span><span class="o">=</span><span class="n">confounds</span><span class="p">)</span>          

    <span class="c1"># make sure all design matrices have the same length of column</span>
    <span class="c1"># if you have a block design, this is not needed.</span>
    <span class="c1"># 39 = 4(events) + 34(confounds) + 13(drift) + 1(constant)</span>
    <span class="k">assert</span> <span class="n">design_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">52</span><span class="p">,</span> <span class="s2">&quot;This design matrix has the wrong column number&quot;</span>
    <span class="c1"># sort the column order alphabetical for contrasts</span>
    <span class="n">design_matrix</span> <span class="o">=</span> <span class="n">design_matrix</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dm_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">_run-</span><span class="si">%s</span><span class="s1">_designmatrix.csv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">))</span>
    <span class="n">design_matrix</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">dm_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dm_path</span><span class="p">,</span> <span class="n">run_id</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-up-the-first-level-contrasts">
<h3><span class="section-number">7.2.2. </span>Set up the first level contrasts<a class="headerlink" href="#set-up-the-first-level-contrasts" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;subj_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;dm_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;contrasts&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">set_contrast</span><span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">dm_path</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Set firstlevel contrast for subject-</span><span class="si">{</span><span class="n">subj_id</span><span class="si">}</span><span class="s2">, run-</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2"> ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
    <span class="n">design_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dm_path</span><span class="p">)</span>
    <span class="n">contrast_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">basic_contrasts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">column</span><span class="p">,</span> <span class="n">contrast_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)])</span>
    <span class="n">contrasts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;pumps-control&#39;</span><span class="p">:</span> <span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;pumps_demean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;control_pumps_demean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;control-pumps&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;control_pumps_demean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;pumps_demean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;pumps-baseline&#39;</span><span class="p">:</span> <span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;pumps_demean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;cash-baseline&#39;</span><span class="p">:</span> <span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;cash_demean&#39;</span><span class="p">],</span>
        <span class="s1">&#39;explode-baseline&#39;</span><span class="p">:</span> <span class="n">basic_contrasts</span><span class="p">[</span><span class="s1">&#39;explode_demean&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">contrasts</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fit-the-first-level-glm">
<h3><span class="section-number">7.2.3. </span>Fit the first level GLM<a class="headerlink" href="#fit-the-first-level-glm" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;subj_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s1">&#39;subj_imgs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;subj_masks&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="s1">&#39;smoothing_fwhm&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="s1">&#39;dm_path&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s1">&#39;contrasts&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span>
        <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;effect_size_path_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;effect_variance_path_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">firstlevel_estimation</span><span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">subj_imgs</span><span class="p">,</span> <span class="n">subj_masks</span><span class="p">,</span> <span class="n">smoothing_fwhm</span><span class="p">,</span> <span class="n">dm_path</span><span class="p">,</span> <span class="n">contrasts</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start firstlevel estimation for subject-</span><span class="si">{</span><span class="n">subj_id</span><span class="si">}</span><span class="s2">, run-</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s2"> ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># subsample img to reduce memory</span>
    <span class="n">run_img</span> <span class="o">=</span> <span class="n">subj_imgs</span><span class="p">[</span><span class="n">run_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">load_img</span><span class="p">(</span><span class="n">run_img</span><span class="p">)</span>
    <span class="n">img_data</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">run_img</span><span class="p">)[::</span><span class="mi">2</span><span class="p">,::</span><span class="mi">2</span><span class="p">,::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">new_img</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">Nifti1Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">affine</span><span class="p">)</span>
    <span class="n">run_mask</span> <span class="o">=</span> <span class="n">subj_masks</span><span class="p">[</span><span class="n">run_id</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fit the firstlevel model...&#39;</span><span class="p">)</span>
    <span class="n">first_level_model</span> <span class="o">=</span> <span class="n">FirstLevelModel</span><span class="p">(</span><span class="n">mask_img</span><span class="o">=</span><span class="n">run_mask</span><span class="p">,</span> <span class="n">smoothing_fwhm</span><span class="o">=</span><span class="n">smoothing_fwhm</span><span class="p">)</span>
    <span class="n">dm</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dm_path</span><span class="p">)</span>
    <span class="n">first_level_model</span> <span class="o">=</span> <span class="n">first_level_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">new_img</span><span class="p">,</span> <span class="n">design_matrices</span><span class="o">=</span><span class="n">dm</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing contrasts...&#39;</span><span class="p">)</span>
    <span class="n">effect_size_path_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">contrasts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">effect_variance_path_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">contrasts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">contrast_id</span><span class="p">,</span> <span class="n">contrast_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contrasts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">contrasts</span><span class="p">),</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="c1"># Estimate the contasts. Note that the model implicitly computes a fixed</span>
        <span class="c1"># effect across the two sessions</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">first_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">contrast_val</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="c1"># write the resulting stat images to file</span>
        <span class="n">effect_size_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">_run-</span><span class="si">%s</span><span class="s1">_contrast-</span><span class="si">%s</span><span class="s1">_effect_size.nii.gz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">effect_variance_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">_run-</span><span class="si">%s</span><span class="s1">_contrast-</span><span class="si">%s</span><span class="s1">_effect_varaince.nii.gz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">,</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">effect_size_path_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">effect_size_path</span>
        <span class="n">effect_variance_path_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">effect_variance_path</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;effect_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">effect_size_path</span><span class="p">)</span>
        <span class="n">res</span><span class="p">[</span><span class="s1">&#39;effect_variance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">effect_variance_path</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">effect_size_path_dict</span><span class="p">,</span> <span class="n">effect_variance_path_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-the-first-level-glm-workflow">
<h3><span class="section-number">7.2.4. </span>Create the first level GLM workflow<a class="headerlink" href="#create-the-first-level-glm-workflow" title="Permalink to this heading">#</a></h3>
<p>This workflow include GLM for each run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initiate the first-level GLM workflow</span>
<span class="n">wf_firstlevel</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wf_firstlevel&#39;</span><span class="p">,</span>
    <span class="n">input_spec</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;subj_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;subj_imgs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;subj_events&#39;</span><span class="p">,</span>
        <span class="s1">&#39;subj_masks&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tr&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_scans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hrf_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;smoothing_fwhm&#39;</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;run_id&#39;</span><span class="p">)</span>
<span class="c1"># add task - get_firstlevel_dm</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">get_firstlevel_dm</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;get_firstlevel_dm&quot;</span><span class="p">,</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">tr</span><span class="p">,</span> 
        <span class="n">n_scans</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">n_scans</span><span class="p">,</span> 
        <span class="n">hrf_model</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">hrf_model</span><span class="p">,</span> 
        <span class="n">subj_id</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_id</span><span class="p">,</span> 
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> 
        <span class="n">subj_imgs</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_imgs</span><span class="p">,</span> 
        <span class="n">subj_events</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_events</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add task - set_contrast</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">set_contrast</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;set_contrast&quot;</span><span class="p">,</span>
        <span class="n">subj_id</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_id</span><span class="p">,</span>
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">get_firstlevel_dm</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span>
        <span class="n">dm_path</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">get_firstlevel_dm</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">dm_path</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add task - firstlevel_estimation</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">firstlevel_estimation</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;firstlevel_estimation&quot;</span><span class="p">,</span>
        <span class="n">subj_id</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_id</span><span class="p">,</span> 
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">get_firstlevel_dm</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> 
        <span class="n">subj_imgs</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_imgs</span><span class="p">,</span> 
        <span class="n">subj_masks</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_masks</span><span class="p">,</span>
        <span class="n">smoothing_fwhm</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">smoothing_fwhm</span><span class="p">,</span> 
        <span class="n">dm_path</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">get_firstlevel_dm</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">dm_path</span><span class="p">,</span> 
        <span class="n">contrasts</span> <span class="o">=</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">set_contrast</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">contrasts</span>
    <span class="p">)</span>
<span class="p">)</span>


<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="s1">&#39;run_id&#39;</span><span class="p">)</span>
<span class="c1"># specify output</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;first_level_contrast&#39;</span><span class="p">,</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">set_contrast</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">contrasts</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;first_level_effect_size_list&#39;</span><span class="p">,</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">firstlevel_estimation</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">effect_size_path_dict</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;first_level_effect_variance_list&#39;</span><span class="p">,</span> <span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">firstlevel_estimation</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">effect_variance_path_dict</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-fixed-effects">
<h3><span class="section-number">7.2.5. </span>Compute fixed effects<a class="headerlink" href="#compute-fixed-effects" title="Permalink to this heading">#</a></h3>
<p>Before we move to the second(group) level, we need to average results from all three runs from a fixed effect model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;subj_id&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
     <span class="s1">&#39;subj_masks&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
     <span class="s1">&#39;contrasts&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
     <span class="s1">&#39;effect_size_path_dict_list&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
     <span class="s1">&#39;effect_variance_path_dict_list&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
     <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fixed_fx_contrast_path_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;fixed_fx_variance_path_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;fixed_fx_ttest_path_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">},</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">get_fixed_effcts</span><span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">subj_masks</span><span class="p">,</span> <span class="n">contrasts</span><span class="p">,</span> <span class="n">effect_size_path_dict_list</span><span class="p">,</span> <span class="n">effect_variance_path_dict_list</span><span class="p">):</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Compute fixed effects for subject-</span><span class="si">{</span><span class="n">subj_id</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
    <span class="c1"># average mask across three runs</span>
    <span class="n">mean_mask</span> <span class="o">=</span> <span class="n">math_img</span><span class="p">(</span><span class="s1">&#39;np.mean(img, axis=-1)&#39;</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">subj_masks</span><span class="p">)</span>
    <span class="c1"># binarize the mean mask</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">math_img</span><span class="p">(</span><span class="s1">&#39;img &gt; 0&#39;</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">mean_mask</span><span class="p">)</span>
    <span class="n">fixed_fx_contrast_path_dict</span> <span class="o">=</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">contrasts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">fixed_fx_variance_path_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">contrasts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">fixed_fx_ttest_path_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">contrasts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">contrast_id</span><span class="p">,</span> <span class="n">contrast_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contrasts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">contrasts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">contrast_imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">img_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">])</span> <span class="k">for</span> <span class="n">img_dict</span> <span class="ow">in</span> <span class="n">effect_size_path_dict_list</span><span class="p">]</span>
        <span class="n">variance_imgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">img_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">])</span> <span class="k">for</span> <span class="n">img_dict</span> <span class="ow">in</span> <span class="n">effect_variance_path_dict_list</span><span class="p">]</span>
        <span class="n">fixed_fx_contrast</span><span class="p">,</span> <span class="n">fixed_fx_variance</span><span class="p">,</span> <span class="n">fixed_fx_ttest</span> <span class="o">=</span> <span class="n">compute_fixed_effects</span><span class="p">(</span><span class="n">contrast_imgs</span><span class="p">,</span> <span class="n">variance_imgs</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        
        <span class="n">effect_size_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">_contrast-</span><span class="si">%s</span><span class="s1">_fx_effect_size.nii.gz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">variance_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">_contrast-</span><span class="si">%s</span><span class="s1">_fx_effect_varaince.nii.gz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">ttest_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;sub-</span><span class="si">%s</span><span class="s1">_contrast-</span><span class="si">%s</span><span class="s1">_ttest_map.nii.gz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">subj_id</span><span class="p">,</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">fixed_fx_contrast_path_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">effect_size_path</span>
        <span class="n">fixed_fx_variance_path_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">variance_path</span>
        <span class="n">fixed_fx_ttest_path_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ttest_path</span>
        
        <span class="n">fixed_fx_contrast</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">effect_size_path</span><span class="p">)</span>
        <span class="n">fixed_fx_variance</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">variance_path</span><span class="p">)</span>
        <span class="n">fixed_fx_ttest</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">ttest_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fixed_fx_contrast_path_dict</span><span class="p">,</span> <span class="n">fixed_fx_variance_path_dict</span><span class="p">,</span> <span class="n">fixed_fx_ttest_path_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-the-fixed-effect-workflow">
<h3><span class="section-number">7.2.6. </span>Create the fixed effect workflow<a class="headerlink" href="#create-the-fixed-effect-workflow" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initiate the fixed effect GLM workflow</span>
<span class="n">wf_fixed_effect</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wf_fixed_effect&#39;</span><span class="p">,</span>
    <span class="n">input_spec</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;subj_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;run_id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tr&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_scans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;hrf_model&#39;</span><span class="p">,</span>
        <span class="s1">&#39;smoothing_fwhm&#39;</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;subj_id&#39;</span><span class="p">)</span>
<span class="c1"># add task - get_subj_file</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">get_subjdata</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;get_subjdata&quot;</span><span class="p">,</span>
        <span class="n">subj_id</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">subj_id</span><span class="p">,</span> 
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subj_id</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_subjdata</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">subj_id</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">run_id</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">tr</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">tr</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_scans</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">n_scans</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">hrf_model</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">hrf_model</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">smoothing_fwhm</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">smoothing_fwhm</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subj_imgs</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_subjdata</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">subj_imgs</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subj_events</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_subjdata</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">subj_events</span>
<span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subj_masks</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_subjdata</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">subj_masks</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wf_firstlevel</span><span class="p">)</span>

<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">get_fixed_effcts</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;get_fixed_effcts&quot;</span><span class="p">,</span>
        <span class="n">subj_id</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_subjdata</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">subj_id</span><span class="p">,</span> 
        <span class="n">subj_masks</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_subjdata</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">subj_masks</span><span class="p">,</span>
        <span class="n">contrasts</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">first_level_contrast</span><span class="p">,</span> 
        <span class="n">effect_size_path_dict_list</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">first_level_effect_size_list</span><span class="p">,</span> 
        <span class="n">effect_variance_path_dict_list</span> <span class="o">=</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">first_level_effect_variance_list</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="s1">&#39;subj_id&#39;</span><span class="p">)</span>
<span class="c1"># specify output</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;first_level_contrast&#39;</span><span class="p">,</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">wf_firstlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">first_level_contrast</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;fx_effect_size_list&#39;</span><span class="p">,</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_fixed_effcts</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">fixed_fx_contrast_path_dict</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;fx_effect_variance_list&#39;</span><span class="p">,</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_fixed_effcts</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">fixed_fx_variance_path_dict</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;fx_t_test_list&#39;</span><span class="p">,</span> <span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">get_fixed_effcts</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">fixed_fx_ttest_path_dict</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="second-level-glm">
<h2><span class="section-number">7.3. </span>Second-Level GLM<a class="headerlink" href="#second-level-glm" title="Permalink to this heading">#</a></h2>
<p>The second level GLM, as known as the group level, averages results across subjects, containing the following steps:</p>
<ul class="simple">
<li><p>construct design matrix</p></li>
<li><p>fit the second-level GLM</p></li>
<li><p>statistical testing</p></li>
</ul>
<section id="get-the-second-level-design-matrix">
<h3><span class="section-number">7.3.1. </span>Get the second level design matrix<a class="headerlink" href="#get-the-second-level-design-matrix" title="Permalink to this heading">#</a></h3>
<p>This is a one-group design. So we need a design matrix for a one-sample test.</p>
<p>The design matrix is a single column of ones, corresponding to the model intercept.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;n_subj&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;design_matrix&#39;</span><span class="p">:</span> <span class="n">ty</span><span class="o">.</span><span class="n">Any</span><span class="p">}}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">get_secondlevel_dm</span><span class="p">(</span><span class="n">n_subj</span><span class="p">):</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Get secondlevel design matrix ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">design_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_subj</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">design_matrix</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fit-the-second-level-glm">
<h3><span class="section-number">7.3.2. </span>Fit the second level GLM<a class="headerlink" href="#fit-the-second-level-glm" title="Permalink to this heading">#</a></h3>
<p>Here, we use the list of FirstLevel z-maps as the input for the SecondLevelModel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;firstlevel_stats_list&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;design_matrix&#39;</span><span class="p">:</span> <span class="n">ty</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="s1">&#39;firstlevel_contrast&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> 
     <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;secondlevel_mask&#39;</span><span class="p">:</span> <span class="n">ty</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="s1">&#39;stat_maps_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">}}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">secondlevel_estimation</span><span class="p">(</span><span class="n">firstlevel_stats_list</span><span class="p">,</span> <span class="n">design_matrix</span><span class="p">,</span> <span class="n">firstlevel_contrast</span><span class="p">):</span>   
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start secondlevel estimation ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">stat_maps_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">contrast_id</span><span class="p">,</span> <span class="n">contrast_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="n">second_level_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">])</span> <span class="k">for</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">firstlevel_stats_list</span><span class="p">]</span>
        <span class="n">second_level_model</span> <span class="o">=</span> <span class="n">SecondLevelModel</span><span class="p">()</span>
        <span class="n">second_level_model</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">second_level_input</span><span class="p">,</span> <span class="n">design_matrix</span><span class="o">=</span><span class="n">design_matrix</span><span class="p">)</span>
        <span class="n">secondlevel_mask</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">masker_</span><span class="o">.</span><span class="n">mask_img_</span>
    
        <span class="n">stats</span> <span class="o">=</span> <span class="n">second_level_model</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="c1"># write the resulting stat images to file</span>
        <span class="n">z_image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;secondlevel_contrast-</span><span class="si">%s</span><span class="s1">_z_map.nii.gz&#39;</span> <span class="o">%</span> <span class="n">contrast_id</span><span class="p">)</span>
        <span class="n">stat_maps_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
        <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;z_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">z_image_path</span><span class="p">)</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;secondlevel_unthresholded_contrast-</span><span class="si">%s</span><span class="s1">_zmap.jpg&#39;</span> <span class="o">%</span> <span class="n">contrast_id</span><span class="p">)</span>
        <span class="n">plot_glass_brain</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;z_score&#39;</span><span class="p">],</span>
                         <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">threshold</span><span class="o">=</span><span class="n">norm</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.001</span><span class="p">),</span>
                         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Unthresholded z map&#39;</span><span class="p">,</span>
                         <span class="n">output_file</span><span class="o">=</span><span class="n">plot_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">secondlevel_mask</span><span class="p">,</span> <span class="n">stat_maps_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-the-second-level-glm-workflow">
<h3><span class="section-number">7.3.3. </span>Create the second level GLM workflow<a class="headerlink" href="#create-the-second-level-glm-workflow" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initiate the first-level GLM workflow</span>
<span class="n">wf_secondlevel</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wf_secondlevel&#39;</span><span class="p">,</span>
    <span class="n">input_spec</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;n_subj&#39;</span><span class="p">,</span>
        <span class="s1">&#39;firstlevel_stats_list&#39;</span><span class="p">,</span> 
        <span class="s1">&#39;firstlevel_contrast&#39;</span><span class="p">,</span>
        <span class="s1">&#39;n_perm&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="c1"># add task - get_secondlevel_dm</span>
<span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">get_secondlevel_dm</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;get_secondlevel_dm&quot;</span><span class="p">,</span>
        <span class="n">n_subj</span> <span class="o">=</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">n_subj</span><span class="p">,</span> 
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add task - secondlevel_estimation</span>
<span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">secondlevel_estimation</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;secondlevel_estimation&quot;</span><span class="p">,</span>
        <span class="n">firstlevel_stats_list</span> <span class="o">=</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">firstlevel_stats_list</span><span class="p">,</span>  
        <span class="n">design_matrix</span> <span class="o">=</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">get_secondlevel_dm</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">design_matrix</span><span class="p">,</span> 
        <span class="n">firstlevel_contrast</span> <span class="o">=</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzin</span><span class="o">.</span><span class="n">firstlevel_contrast</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># specify output</span>
<span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;second_level_designmatrix&#39;</span><span class="p">,</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">get_secondlevel_dm</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">design_matrix</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;second_level_mask&#39;</span><span class="p">,</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">secondlevel_estimation</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">secondlevel_mask</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;second_level_stats_map&#39;</span><span class="p">,</span> <span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">secondlevel_estimation</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">stat_maps_dict</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="statistical-testing">
<h2><span class="section-number">7.4. </span>Statistical Testing<a class="headerlink" href="#statistical-testing" title="Permalink to this heading">#</a></h2>
<p>In this section, we present different ways of doing statistical testing</p>
<ol class="arabic simple">
<li><p>Cluster-thresholding without multiple comparison</p></li>
<li><p>Multiple comparison using FDR</p></li>
<li><p>Paramatric testing</p></li>
<li><p>Nonparamatric testing</p></li>
</ol>
<section id="cluster-thresholding-and-plot-without-multiple-comparison">
<h3><span class="section-number">7.4.1. </span>Cluster-thresholding and Plot without multiple comparison<a class="headerlink" href="#cluster-thresholding-and-plot-without-multiple-comparison" title="Permalink to this heading">#</a></h3>
<p>Threshold the resulting map without multiple comparisons correction, abs(z) &gt; 3.29 (equivalent to p &lt; 0.001), cluster size &gt; 10 voxels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;stat_maps_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;cluster_threshold&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
     <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;thresholded_map_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;plot_contrast_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">}}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">cluster_thresholding</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">cluster_threshold</span><span class="p">):</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start cluster thresholding ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">thresholded_map_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">plot_contrast_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">stats_id</span><span class="p">,</span> <span class="n">stats_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="p">),</span> <span class="n">stats_id</span><span class="p">))</span>
        <span class="n">thresholded_map</span> <span class="o">=</span> <span class="n">threshold_img</span><span class="p">(</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">stats_val</span><span class="p">[</span><span class="s1">&#39;z_score&#39;</span><span class="p">],</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
            <span class="n">cluster_threshold</span><span class="o">=</span><span class="n">cluster_threshold</span><span class="p">,</span>
            <span class="n">two_sided</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">thresholded_map_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;secondlevel_cluster_thresholded_contrast-</span><span class="si">%s</span><span class="s1">_z_map.nii.gz&#39;</span> <span class="o">%</span> <span class="n">stats_id</span><span class="p">)</span>
        <span class="n">thresholded_map_dict</span><span class="p">[</span><span class="n">stats_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresholded_map_path</span>
        <span class="n">thresholded_map</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">thresholded_map_path</span><span class="p">)</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> 
                                   <span class="s1">&#39;secondlevel_cluster_thresholded_contrast-</span><span class="si">%s</span><span class="s1">_zmap.jpg&#39;</span> <span class="o">%</span> <span class="n">stats_id</span><span class="p">)</span>
        <span class="n">plot_contrast_dict</span><span class="p">[</span><span class="n">stats_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_path</span>
        <span class="n">plot_stat_map</span><span class="p">(</span><span class="n">thresholded_map</span><span class="p">,</span>
                               <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Cluster Thresholded z map&#39;</span><span class="p">,</span>
                               <span class="n">output_file</span><span class="o">=</span><span class="n">plot_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cluster thresholding is done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thresholded_map_dict</span><span class="p">,</span> <span class="n">plot_contrast_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiple-comparison-and-plot">
<h3><span class="section-number">7.4.2. </span>Multiple comparison and Plot<a class="headerlink" href="#multiple-comparison-and-plot" title="Permalink to this heading">#</a></h3>
<p>We have the following choices:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fdr</span></code>: False Discovery Rate (FDR &lt;.05) and no cluster-level threshold</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fpr</span></code>: False Positive Rate</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bonferroni</span></code></p></li>
</ul>
<p>More details see <a class="reference external" href="https://nilearn.github.io/stable/modules/generated/nilearn.glm.threshold_stats_img.html#nilearn.glm.threshold_stats_img">here</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;stat_maps_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;height_control&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
     <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;thresholded_map_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;plot_contrast_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">}}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">multiple_comparison</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">height_control</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start multiple comparison ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">nilearn.glm</span> <span class="kn">import</span> <span class="n">threshold_stats_img</span>
    <span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <span class="n">plot_stat_map</span>
    <span class="n">thresholded_map_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">plot_contrast_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">stats_id</span><span class="p">,</span> <span class="n">stats_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="p">),</span> <span class="n">stats_id</span><span class="p">))</span>
        <span class="n">thresholded_map</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_stats_img</span><span class="p">(</span>
            <span class="n">stat_img</span><span class="o">=</span><span class="n">stats_val</span><span class="p">[</span><span class="s1">&#39;z_score&#39;</span><span class="p">],</span> 
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> 
            <span class="n">height_control</span><span class="o">=</span><span class="n">height_control</span><span class="p">)</span>
        <span class="n">thresholded_map_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> 
                                         <span class="s1">&#39;secondlevel_multiple_comp_corrected_contrast-</span><span class="si">%s</span><span class="s1">_z_map.nii.gz&#39;</span> <span class="o">%</span> <span class="n">stats_id</span><span class="p">)</span>
        <span class="n">thresholded_map_dict</span><span class="p">[</span><span class="n">stats_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresholded_map_path</span>
        <span class="n">thresholded_map</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">thresholded_map_path</span><span class="p">)</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> 
                                   <span class="s1">&#39;secondlevel_multiple_comp_corrected_contrast-</span><span class="si">%s</span><span class="s1">_zmap.jpg&#39;</span> <span class="o">%</span> <span class="n">stats_id</span><span class="p">)</span>
        <span class="n">plot_contrast_dict</span><span class="p">[</span><span class="n">stats_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_path</span>
        <span class="n">plot_stat_map</span><span class="p">(</span><span class="n">thresholded_map</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Thresholded z map, expected fdr = .05&#39;</span><span class="p">,</span>
                      <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> 
                      <span class="n">output_file</span><span class="o">=</span><span class="n">plot_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Multiple comparison is done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thresholded_map_dict</span><span class="p">,</span> <span class="n">plot_contrast_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="paramatric-test-plot">
<h3><span class="section-number">7.4.3. </span>Paramatric test &amp; Plot<a class="headerlink" href="#paramatric-test-plot" title="Permalink to this heading">#</a></h3>
<p>We threshold the second level contrast at uncorrected p &lt; 0.001.</p>
<p>A nilearn example see <a class="reference external" href="https://nilearn.github.io/dev/auto_examples/05_glm_second_level/plot_second_level_one_sample_test.html">here</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;stat_maps_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> 
     <span class="s1">&#39;secondlevel_mask&#39;</span><span class="p">:</span> <span class="n">ty</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span>
     <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;thresholded_map_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;plot_contrast_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">}}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">parametric_test</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="p">,</span> <span class="n">secondlevel_mask</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start parametric test ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">thresholded_map_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">plot_contrast_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">stats_id</span><span class="p">,</span> <span class="n">stats_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stat_maps_dict</span><span class="p">),</span> <span class="n">stats_id</span><span class="p">))</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">stats_val</span><span class="p">[</span><span class="s1">&#39;p_value&#39;</span><span class="p">]</span>
        <span class="n">n_voxels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">get_data</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">secondlevel_mask</span><span class="p">))</span>
        <span class="c1"># Correcting the p-values for multiple testing and taking negative logarithm</span>
        <span class="n">neg_log_pval</span> <span class="o">=</span> <span class="n">math_img</span><span class="p">(</span><span class="s2">&quot;-np.log10(np.minimum(1, img * </span><span class="si">{}</span><span class="s2">))&quot;</span>
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n_voxels</span><span class="p">)),</span>
                                <span class="n">img</span><span class="o">=</span><span class="n">p_val</span><span class="p">)</span>
        
        <span class="n">thresholded_map_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;secondlevel_paramatric_thresholded_contrast-</span><span class="si">%s</span><span class="s1">_z_map.nii.gz&#39;</span> <span class="o">%</span> <span class="n">stats_id</span><span class="p">)</span>
        <span class="n">thresholded_map_dict</span><span class="p">[</span><span class="n">stats_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresholded_map_path</span>
        <span class="n">neg_log_pval</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">thresholded_map_path</span><span class="p">)</span>
    
        <span class="c1"># Since we are plotting negative log p-values and using a threshold equal to 1,</span>
        <span class="c1"># it corresponds to corrected p-values lower than 10%, meaning that there is</span>
        <span class="c1"># less than 10% probability to make a single false discovery (90% chance that</span>
        <span class="c1"># we make no false discovery at all).  This threshold is much more conservative</span>
        <span class="c1"># than the previous one.</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;parametric test (FWER &lt; 10%)&#39;</span><span class="p">)</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> 
                                   <span class="s1">&#39;secondlevel_paramatric_thresholded_contrast-</span><span class="si">%s</span><span class="s1">_zmap.jpg&#39;</span> <span class="o">%</span> <span class="n">stats_id</span><span class="p">)</span>
        <span class="n">plot_contrast_dict</span><span class="p">[</span><span class="n">stats_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_path</span>
        <span class="n">plot_stat_map</span><span class="p">(</span>
            <span class="n">neg_log_pval</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">plot_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parametric test is done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thresholded_map_dict</span><span class="p">,</span> <span class="n">plot_contrast_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="non-paramatric-test-plot">
<h3><span class="section-number">7.4.4. </span>Non-paramatric test &amp; Plot<a class="headerlink" href="#non-paramatric-test-plot" title="Permalink to this heading">#</a></h3>
<p>Here we compute the (corrected) negative log p-values with permutation test.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">task</span>
<span class="nd">@pydra</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;firstlevel_stats_list&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;smoothing_fwhm&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;design_matrix&#39;</span><span class="p">:</span> <span class="n">ty</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="s1">&#39;firstlevel_contrast&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;n_perm&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
     <span class="s1">&#39;return&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;thresholded_map_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;plot_contrast_dict&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">}}</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">nonparametric_test</span><span class="p">(</span><span class="n">firstlevel_stats_list</span><span class="p">,</span> <span class="n">smoothing_fwhm</span><span class="p">,</span> <span class="n">design_matrix</span><span class="p">,</span> <span class="n">firstlevel_contrast</span><span class="p">,</span> <span class="n">n_perm</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Start nonparametric test ...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">thresholded_map_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">plot_contrast_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">contrast_id</span><span class="p">,</span> <span class="n">contrast_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Contrast </span><span class="si">% 2i</span><span class="s1"> out of </span><span class="si">%i</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstlevel_contrast</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">contrast_id</span><span class="p">))</span>
        <span class="c1"># here we set threshold as none to do voxel-level FWER-correction.</span>
        <span class="n">second_level_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">])</span> <span class="k">for</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">firstlevel_stats_list</span><span class="p">]</span>
        <span class="n">neg_log_pvals_permuted_ols_unmasked</span> <span class="o">=</span> \
            <span class="n">non_parametric_inference</span><span class="p">(</span><span class="n">second_level_input</span><span class="o">=</span><span class="n">second_level_input</span><span class="p">,</span> <span class="n">design_matrix</span><span class="o">=</span><span class="n">design_matrix</span><span class="p">,</span>
                                     <span class="n">model_intercept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_perm</span><span class="o">=</span><span class="n">n_perm</span><span class="p">,</span>
                                     <span class="n">two_sided_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">smoothing_fwhm</span><span class="o">=</span><span class="n">smoothing_fwhm</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">thresholded_map_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;secondlevel_permutation_contrast-</span><span class="si">%s</span><span class="s1">_z_map.nii.gz&#39;</span> <span class="o">%</span> <span class="n">contrast_id</span><span class="p">)</span>
        <span class="n">thresholded_map_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">thresholded_map_path</span>
        <span class="n">neg_log_pvals_permuted_ols_unmasked</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">thresholded_map_path</span><span class="p">)</span>
        <span class="c1"># here I actually have more than one contrast</span>
        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;permutation test (FWER &lt; 10%)&#39;</span><span class="p">)</span>
        <span class="n">plot_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s1">&#39;secondlevel_permutation_contrast-</span><span class="si">%s</span><span class="s1">_zmap.jpg&#39;</span> <span class="o">%</span> <span class="n">contrast_id</span><span class="p">)</span>
        <span class="n">plot_contrast_dict</span><span class="p">[</span><span class="n">contrast_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">plot_path</span>
        <span class="n">plot_stat_map</span><span class="p">(</span>
            <span class="n">neg_log_pvals_permuted_ols_unmasked</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="n">plot_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Permutation is done&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thresholded_map_dict</span><span class="p">,</span> <span class="n">plot_contrast_dict</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="the-ultimate-workflow">
<h2><span class="section-number">7.5. </span>The Ultimate Workflow<a class="headerlink" href="#the-ultimate-workflow" title="Permalink to this heading">#</a></h2>
<p>Now, let’s connect all tasks and workflows together.</p>
<p>Here we randomly choose <strong>5</strong> subjects to perform the analysis.</p>
<p>For computational time, we set <code class="docutils literal notranslate"><span class="pre">n_perm=100</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;twolevel_glm&#39;</span><span class="p">,</span>
    <span class="n">input_spec</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n_subj&#39;</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">wf</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_subj</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># randomly choose subjects</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subj_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span> <span class="n">wf</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_subj</span><span class="p">)</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">run_id</span> <span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">tr</span> <span class="o">=</span> <span class="mf">2.3</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_scans</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">hrf_model</span> <span class="o">=</span> <span class="s1">&#39;glover&#39;</span>
<span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">smoothing_fwhm</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">wf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wf_fixed_effect</span><span class="p">)</span>

<span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_subj</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_subj</span>
<span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">firstlevel_stats_list</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">fx_t_test_list</span> 
<span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">firstlevel_contrast</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">first_level_contrast</span>
<span class="n">wf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wf_secondlevel</span><span class="p">)</span>

<span class="c1"># add task - cluster_thresholding</span>
<span class="n">wf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">cluster_thresholding</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;cluster_thresholding&quot;</span><span class="p">,</span>
        <span class="n">stat_maps_dict</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">second_level_stats_map</span><span class="p">,</span> 
        <span class="n">threshold</span> <span class="o">=</span> <span class="mf">3.29</span><span class="p">,</span> 
        <span class="n">cluster_threshold</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="p">)</span>
<span class="p">)</span>


<span class="c1"># add task - multiple_comparison</span>
<span class="n">wf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">multiple_comparison</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;multiple_comparison&quot;</span><span class="p">,</span>
        <span class="n">stat_maps_dict</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">second_level_stats_map</span><span class="p">,</span> 
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">height_control</span> <span class="o">=</span> <span class="s1">&#39;fdr&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add task - parametric_test</span>
<span class="n">wf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">parametric_test</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;parametric_test&quot;</span><span class="p">,</span>
        <span class="n">stat_maps_dict</span> <span class="o">=</span>  <span class="n">wf</span><span class="o">.</span><span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">second_level_stats_map</span><span class="p">,</span> 
        <span class="n">secondlevel_mask</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">second_level_mask</span>
    <span class="p">)</span>
    
<span class="p">)</span>

<span class="c1"># add task - nonparametric_test</span>
<span class="n">wf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
    <span class="n">nonparametric_test</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;nonparametric_test&quot;</span><span class="p">,</span>
        <span class="n">firstlevel_stats_list</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">fx_t_test_list</span><span class="p">,</span>
        <span class="n">smoothing_fwhm</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">design_matrix</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">second_level_designmatrix</span><span class="p">,</span>
        <span class="n">firstlevel_contrast</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_fixed_effect</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">first_level_contrast</span><span class="p">,</span>
        <span class="n">n_perm</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">wf</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;second_level_stats_map&#39;</span><span class="p">,</span> <span class="n">wf</span><span class="o">.</span><span class="n">wf_secondlevel</span><span class="o">.</span><span class="n">lzout</span><span class="o">.</span><span class="n">second_level_stats_map</span><span class="p">)</span>   
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="run-workflow-run">
<h3><span class="section-number">7.5.1. </span>Run Workflow Run<a class="headerlink" href="#run-workflow-run" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydra</span> <span class="kn">import</span> <span class="n">Submitter</span>

<span class="k">with</span> <span class="n">Submitter</span><span class="p">(</span><span class="n">plugin</span><span class="o">=</span><span class="s1">&#39;cf&#39;</span><span class="p">,</span> <span class="n">n_procs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">submitter</span><span class="p">:</span>
    <span class="n">submitter</span><span class="p">(</span><span class="n">wf</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">wf</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Download data for subject-4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-1_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-2_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-04/func/sub-04_task-balloonanalogrisktask_run-3_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Download data for subject-1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-1_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-2_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-01/func/sub-01_task-balloonanalogrisktask_run-3_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Download data for subject-13
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-1_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-2_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-13/func/sub-13_task-balloonanalogrisktask_run-3_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Download data for subject-8
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-1_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-2_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-08/func/sub-08_task-balloonanalogrisktask_run-3_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Download data for subject-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-preproc_bold.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-1_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-2_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-3_space-MNI152NLin2009cAsym_res-2_desc-brain_mask.nii.gz (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-1_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-2_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>get
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ok
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>): sub-11/func/sub-11_task-balloonanalogrisktask_run-3_desc-confounds_timeseries.tsv (
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>file
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>) [from openneuro-derivatives...]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-4, run-1 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-4, run-2 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-4, run-3 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-1, run-1 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-1, run-2 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-1, run-3 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-13, run-1 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-13, run-2 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-13, run-3 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-8, run-1 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-8, run-2 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-8, run-3 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-11, run-1 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-11, run-2 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get subject-11, run-3 firstlevel GLM design matrix...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-4, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-4, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-4, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-1, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-1, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-1, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-13, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-13, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-13, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-8, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-8, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-8, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-11, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-11, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Set firstlevel contrast for subject-11, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-4, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-4, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-4, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-1, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-1, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-1, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-13, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-13, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-13, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-8, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-8, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-8, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-11, run-1 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-11, run-2 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start firstlevel estimation for subject-11, run-3 ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fit the firstlevel model...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing contrasts...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compute fixed effects for subject-4...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compute fixed effects for subject-1...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compute fixed effects for subject-13...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compute fixed effects for subject-8...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Compute fixed effects for subject-11...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Get secondlevel design matrix ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start secondlevel estimation ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start cluster thresholding ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cluster thresholding is done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start nonparametric test ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Permutation is done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start multiple comparison ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Multiple comparison is done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start parametric test ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  1 out of 5: pumps-control
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  2 out of 5: control-pumps
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  3 out of 5: pumps-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  4 out of 5: cash-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Contrast  5 out of 5: explode-baseline
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parametric test is done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Result(output=Output(second_level_stats_map={&#39;pumps-control&#39;: {&#39;z_score&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab97a1690&gt;, &#39;stat&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959c050&gt;, &#39;p_value&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959dad0&gt;, &#39;effect_size&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959df10&gt;, &#39;effect_variance&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959e090&gt;}, &#39;control-pumps&#39;: {&#39;z_score&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959eb90&gt;, &#39;stat&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959e790&gt;, &#39;p_value&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab959d3d0&gt;, &#39;effect_size&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faaba1e6e10&gt;, &#39;effect_variance&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab9d9db90&gt;}, &#39;pumps-baseline&#39;: {&#39;z_score&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab9b3c190&gt;, &#39;stat&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab9978290&gt;, &#39;p_value&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab9978a90&gt;, &#39;effect_size&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab93f6c90&gt;, &#39;effect_variance&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab93f5b50&gt;}, &#39;cash-baseline&#39;: {&#39;z_score&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab93f47d0&gt;, &#39;stat&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab93f56d0&gt;, &#39;p_value&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab93f4290&gt;, &#39;effect_size&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab94f72d0&gt;, &#39;effect_variance&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab94f4c90&gt;}, &#39;explode-baseline&#39;: {&#39;z_score&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab94f7f90&gt;, &#39;stat&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab9441f10&gt;, &#39;p_value&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab94428d0&gt;, &#39;effect_size&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab9442250&gt;, &#39;effect_variance&#39;: &lt;nibabel.nifti1.Nifti1Image object at 0x7faab94423d0&gt;}}), runtime=None, errored=False)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="let-s-plot">
<h2><span class="section-number">7.6. </span>Let’s Plot!<a class="headerlink" href="#let-s-plot" title="Permalink to this heading">#</a></h2>
<p>We only use 5 subjects, so it’s reasonable the following plots have nothing survived from testing.</p>
<section id="unthresholded">
<h3><span class="section-number">7.6.1. </span>Unthresholded<a class="headerlink" href="#unthresholded" title="Permalink to this heading">#</a></h3>
<p>Let’s plot the unthresholded image first.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">ut_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s2">&quot;secondlevel_unthresholded*.jpg&quot;</span><span class="p">))</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">ut_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/f628a891dbb1f0b8557dead215300063966b71bc116c79b17e33ace02c5e7616.jpg" src="../_images/f628a891dbb1f0b8557dead215300063966b71bc116c79b17e33ace02c5e7616.jpg" />
</div>
</div>
</section>
<section id="cluster-thresholding">
<h3><span class="section-number">7.6.2. </span>Cluster Thresholding<a class="headerlink" href="#cluster-thresholding" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">ct_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s2">&quot;secondlevel_cluster_thresholded*.jpg&quot;</span><span class="p">))</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">ct_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/19e94aa3b74f2db8ad05be3caec443f35d37dbf68d9deb48ad90ed24d60ff245.jpg" src="../_images/19e94aa3b74f2db8ad05be3caec443f35d37dbf68d9deb48ad90ed24d60ff245.jpg" />
</div>
</div>
</section>
<section id="multiple-comparison">
<h3><span class="section-number">7.6.3. </span>Multiple Comparison<a class="headerlink" href="#multiple-comparison" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s2">&quot;secondlevel_multiple_comp*.jpg&quot;</span><span class="p">))</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">mc_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/3b18c95bd46b9952e4ad507a7e272106b5d6e53edf0fc431bdccb427538bd25f.jpg" src="../_images/3b18c95bd46b9952e4ad507a7e272106b5d6e53edf0fc431bdccb427538bd25f.jpg" />
</div>
</div>
</section>
<section id="paramatric-test">
<h3><span class="section-number">7.6.4. </span>Paramatric Test<a class="headerlink" href="#paramatric-test" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pt_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s2">&quot;secondlevel_paramatric*.jpg&quot;</span><span class="p">))</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">pt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/6a5249070180afc9d05eeddef682d7be29b68a9a60d289105ef58f45236a763e.jpg" src="../_images/6a5249070180afc9d05eeddef682d7be29b68a9a60d289105ef58f45236a763e.jpg" />
</div>
</div>
</section>
<section id="nonparamatric-test">
<h3><span class="section-number">7.6.5. </span>Nonparamatric Test<a class="headerlink" href="#nonparamatric-test" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">npt_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_out_dir</span><span class="p">,</span> <span class="s2">&quot;secondlevel_permutation*.jpg&quot;</span><span class="p">))</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">npt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/cd5836356f179e5437bf5b10e1078e9e8a40640c12a3d4048d5ed2bb493cda1d.jpg" src="../_images/cd5836356f179e5437bf5b10e1078e9e8a40640c12a3d4048d5ed2bb493cda1d.jpg" />
</div>
</div>
</section>
</section>
<section id="exercise-1">
<h2><span class="section-number">7.7. </span>Exercise #1<a class="headerlink" href="#exercise-1" title="Permalink to this heading">#</a></h2>
<p>In this example, we conducted GLM on each run per subject separately and then used a fixed-effect model to average across runs.</p>
<p>Where did we put <code class="docutils literal notranslate"><span class="pre">.splitter</span></code> and <code class="docutils literal notranslate"><span class="pre">.combiner</span></code>. Why did we put it there?</p>
</section>
<section id="exercise-2">
<h2><span class="section-number">7.8. </span>Exercise #2<a class="headerlink" href="#exercise-2" title="Permalink to this heading">#</a></h2>
<p>Moreover, We choose this approach due to limited memory on GitHub. <a class="reference external" href="https://nilearn.github.io/stable/modules/generated/nilearn.glm.first_level.FirstLevelModel.html">FirstLevelModel</a> in Nilearn also allows to compute multiple runs with a fixed-effect model simultanously. Here is an <a class="reference external" href="https://nilearn.github.io/stable/auto_examples/04_glm_first_level/plot_fiac_analysis.html#sphx-glr-auto-examples-04-glm-first-level-plot-fiac-analysis-py">example</a>.</p>
<p>Would you like to give it a try on your own?</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="6_firstlevel_glm_nilearn.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title"><span class="section-number">6. </span>First Level GLM (from Nilearn)</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../about/team.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Team</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparation">
   7.1. Preparation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-the-data">
     7.1.1. Download the data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-data-for-each-subject">
     7.1.2. Get data for each subject
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#first-level-glm">
   7.2. First-Level GLM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-first-level-design-matrix">
     7.2.1. Get the first-level design matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-the-first-level-contrasts">
     7.2.2. Set up the first level contrasts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-the-first-level-glm">
     7.2.3. Fit the first level GLM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-first-level-glm-workflow">
     7.2.4. Create the first level GLM workflow
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-fixed-effects">
     7.2.5. Compute fixed effects
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-fixed-effect-workflow">
     7.2.6. Create the fixed effect workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#second-level-glm">
   7.3. Second-Level GLM
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-second-level-design-matrix">
     7.3.1. Get the second level design matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-the-second-level-glm">
     7.3.2. Fit the second level GLM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-second-level-glm-workflow">
     7.3.3. Create the second level GLM workflow
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#statistical-testing">
   7.4. Statistical Testing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-thresholding-and-plot-without-multiple-comparison">
     7.4.1. Cluster-thresholding and Plot without multiple comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-comparison-and-plot">
     7.4.2. Multiple comparison and Plot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paramatric-test-plot">
     7.4.3. Paramatric test &amp; Plot
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#non-paramatric-test-plot">
     7.4.4. Non-paramatric test &amp; Plot
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-ultimate-workflow">
   7.5. The Ultimate Workflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-workflow-run">
     7.5.1. Run Workflow Run
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-s-plot">
   7.6. Let’s Plot!
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unthresholded">
     7.6.1. Unthresholded
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cluster-thresholding">
     7.6.2. Cluster Thresholding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-comparison">
     7.6.3. Multiple Comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#paramatric-test">
     7.6.4. Paramatric Test
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nonparamatric-test">
     7.6.5. Nonparamatric Test
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-1">
   7.7. Exercise #1
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercise-2">
   7.8. Exercise #2
  </a>
 </li>
</ul>

</nav>
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Pydra Developers
</p>

  </div>
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on None.<br>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>